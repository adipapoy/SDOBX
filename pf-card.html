<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools Rekomendasi PF - Burden - Spasi per Seam</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #1a2980, #26d0ce);
            color: white;
            padding: 25px 30px;
            text-align: center;
            border-bottom: 5px solid #3498db;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        /* BACK HOME BUTTON */
        .back-home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .back-home-btn:hover {
            background: white;
            color: #1a2980;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 992px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .back-home-btn {
                position: relative;
                top: 0;
                left: 0;
                margin-bottom: 15px;
                display: inline-flex;
            }
        }
        
        .selection-section {
            background-color: #f0f7ff;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #bbdefb;
        }
        
        .selection-section h3 {
            color: #1a2980;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-section {
            background-color: #e8f4fd;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #90caf9;
        }
        
        .result-section h3 {
            color: #1a2980;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #262626;
            font-size: 15px;
        }
        
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #bbdefb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: white;
            cursor: pointer;
        }
        
        select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .pit-seam-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .generate-btn {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
        }
        
        .generate-btn:hover {
            background: linear-gradient(90deg, #2980b9, #1a2980);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .reset-btn {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .reset-btn:hover {
            background: linear-gradient(90deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .recommendation-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border: 3px solid #3498db;
            margin-bottom: 25px;
        }
        
        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e3f2fd;
        }
        
        .location-info {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1a2980;
        }
        
        .location-details {
            font-size: 14px;
            color: #3498db;
            margin-top: 5px;
        }
        
        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .recommendation-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .param-card {
            background: #f8fbff;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 2px solid #bbdefb;
            transition: transform 0.3s;
        }
        
        .param-card:hover {
            transform: translateY(-5px);
            border-color: #3498db;
        }
        
        .param-card.primary {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-color: #3498db;
        }
        
        .param-label {
            font-size: 14px;
            color: #555;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .param-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #1a2980;
            margin: 10px 0;
        }
        
        .param-unit {
            color: #3498db;
            font-size: 14px;
            font-weight: 600;
        }
        
        .notes-section {
            background: #fff8e1;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #f39c12;
        }
        
        .notes-section h4 {
            color: #d35400;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
            border-top: 1px solid #e8e8e8;
            margin-top: 30px;
            grid-column: 1 / -1;
        }
        
        .history-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        
        .history-section h4 {
            color: #1a2980;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .history-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #3498db;
            font-size: 14px;
            cursor: pointer;
        }
        
        .history-item:hover {
            background: #e8f4fd;
        }
        
        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .generate-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        /* HAPUS material-info styles */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- BACK HOME BUTTON -->
            <button class="back-home-btn" id="backHomeBtn">
                <span>Back to home</span>
            </button>
            
            <h1>Tools Rekomendasi PF - Burden - Spasi per Seam</h1>
            <p>Database rekomendasi parameter peledakan berdasarkan lokasi dan kondisi seam</p>
        </div>
        
        <div class="content">
            <!-- SELECTION SECTION -->
            <div class="selection-section">
                <h3>üéØ Pilih Parameter</h3>
                
                <div class="pit-seam-info">
                    <div class="input-group">
                        <label for="pitSelect">PIT:</label>
                        <select id="pitSelect">
                            <option value="">-- Pilih PIT --</option>
                            <!-- Options akan diisi oleh JavaScript -->
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="seamSelect">Seam:</label>
                        <select id="seamSelect">
                            <option value="">-- Pilih Seam --</option>
                            <!-- Options akan diisi oleh JavaScript -->
                        </select>
                    </div>
                </div>
                
                <!-- KOLOM MATERIAL DROPDOWN -->
                <div class="input-group">
                    <label for="materialSelect">Material:</label>
                    <select id="materialSelect">
                        <option value="">-- Pilih Material --</option>
                        <!-- Options akan diisi oleh JavaScript -->
                    </select>
                </div>
                
                <div class="buttons">
                    <button class="generate-btn" id="generateBtn" disabled>
                        <span>üöÄ Generate Rekomendasi</span>
                    </button>
                    <button class="reset-btn" id="resetBtn">
                        <span>üîÑ Reset</span>
                    </button>
                </div>
                
                <div class="history-section" id="historySection" style="display: none;">
                    <h4>üìú History Rekomendasi</h4>
                    <div id="historyList"></div>
                </div>
            </div>
            
            <!-- RESULT SECTION -->
            <div class="result-section">
                <h3>üìã Hasil Rekomendasi</h3>
                
                <div id="resultContainer">
                    <div class="recommendation-card" style="opacity: 0.7;">
                        <div class="recommendation-header">
                            <div>
                                <div class="location-info">Pilih Parameter</div>
                                <div class="location-details">Silakan pilih PIT, Seam, dan Material</div>
                            </div>
                        </div>
                        
                        <div class="recommendation-grid">
                            <div class="param-card">
                                <div class="param-label">Powder Factor</div>
                                <div class="param-value">-</div>
                                <div class="param-unit">kg/m¬≥</div>
                            </div>
                            
                            <div class="param-card">
                                <div class="param-label">Burden</div>
                                <div class="param-value">-</div>
                                <div class="param-unit">meter</div>
                            </div>
                            
                            <div class="param-card">
                                <div class="param-label">Spasi</div>
                                <div class="param-value">-</div>
                                <div class="param-unit">meter</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; color: #999; padding: 20px;">
                            <p>Parameter akan ditampilkan setelah Anda mengisi semua data</p>
                        </div>
                    </div>
                </div>
                
                <!-- HAPUS: material-info section -->
                
                <div class="notes-section" id="notesSection" style="display: none;">
                    <h4>üìù Catatan & Rekomendasi</h4>
                    <p id="notesText">-</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Tools Rekomendasi PF v2.0 | Database External | Parameter: PF, Burden, Spasi | <span id="currentDate"></span></p>
        </div>
    </div>
    
    <!-- Load database file -->
    <script src="database.js"></script>
    
    <script>
        // MAIN APPLICATION SCRIPT
        
        // Global variables
        let currentRecommendation = null;
        let recommendationHistory = [];
        
        // Configuration
        const CONFIG = {
            decimalPlaces: {
                pf: 2,
                burden: 1,
                spacing: 1
            },
            units: {
                pf: "kg/m¬≥",
                burden: "meter",
                spacing: "meter"
            }
        };
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
        
        function initializeApp() {
            // Set current date in footer
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            populateDropdowns();
            setupEventListeners();
            loadHistory();
        }
        
        function populateDropdowns() {
            populatePITs();
            populateSeams();
            populateMaterials();
        }
        
        function populatePITs() {
            const pitSelect = document.getElementById('pitSelect');
            pitSelect.innerHTML = '<option value="">-- Pilih PIT --</option>';
            
            availablePITs.forEach(pit => {
                const option = document.createElement('option');
                option.value = pit.value;
                option.textContent = `${pit.name} (${pit.location})`;
                pitSelect.appendChild(option);
            });
        }
        
        function populateSeams() {
            const seamSelect = document.getElementById('seamSelect');
            seamSelect.innerHTML = '<option value="">-- Pilih Seam --</option>';
            
            // Show all seams by default
            const allSeams = ['27', '28', '29', '30', '35', '36', '37', '38'];
            allSeams.forEach(seam => {
                const option = document.createElement('option');
                option.value = seam;
                option.textContent = `Seam ${seam}`;
                seamSelect.appendChild(option);
            });
        }
        
        function populateMaterials() {
            const materialSelect = document.getElementById('materialSelect');
            materialSelect.innerHTML = '<option value="">-- Pilih Material --</option>';
            
            availableMaterials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.value;
                option.textContent = `${material.name} - ${material.description}`;
                materialSelect.appendChild(option);
            });
        }
        
        function updateSeams(pit) {
            const seamSelect = document.getElementById('seamSelect');
            seamSelect.innerHTML = '<option value="">-- Pilih Seam --</option>';
            
            const seams = seamMapping[pit] || ['27', '28', '29', '30', '35', '36', '37', '38'];
            seams.forEach(seam => {
                const option = document.createElement('option');
                option.value = seam;
                option.textContent = `Seam ${seam}`;
                seamSelect.appendChild(option);
            });
        }
        
        function setupEventListeners() {
            // Main functionality
            document.getElementById('generateBtn').addEventListener('click', generateRecommendation);
            document.getElementById('resetBtn').addEventListener('click', resetTools);
            
            // Back home button
            document.getElementById('backHomeBtn').addEventListener('click', goBackHome);
            
            // Form completion check
            document.getElementById('pitSelect').addEventListener('change', function(e) {
                updateSeams(e.target.value);
                checkFormCompletion();
            });
            
            document.getElementById('seamSelect').addEventListener('change', checkFormCompletion);
            document.getElementById('materialSelect').addEventListener('change', checkFormCompletion);
        }
        
        function checkFormCompletion() {
            const pit = document.getElementById('pitSelect').value;
            const seam = document.getElementById('seamSelect').value;
            const material = document.getElementById('materialSelect').value;
            const generateBtn = document.getElementById('generateBtn');
            
            if (pit && seam && material) {
                generateBtn.disabled = false;
            } else {
                generateBtn.disabled = true;
            }
        }
        
        // BACK HOME FUNCTION
        function goBackHome() {
            // Show confirmation dialog
            {
                // In real implementation, redirect to actual home page
                // window.location.href = '/home.html';
                
                // For demo, just reload current page
                window.location.href = 'index.html';
            }
        }
        
        function generateRecommendation() {
            const pit = document.getElementById('pitSelect').value;
            const seam = document.getElementById('seamSelect').value;
            const material = document.getElementById('materialSelect').value;
            
            console.log("Generate clicked:", pit, seam, material);
            
            // Validation
            if (!validateInput(pit, seam, material)) {
                return;
            }
            
            // Get base recommendation from database
            const key = `${pit}_${seam}_${material}`;
            console.log("Looking for key:", key);
            
            let recommendation = recommendationDB[key] || recommendationDB[`default_${material}`];
            
            // Jika tidak ada data sama sekali, gunakan default
            if (!recommendation) {
                recommendation = {
                    pf: 0.40, 
                    burden: 4.0, 
                    spacing: 4.5
                };
            }
            
            console.log("Found recommendation:", recommendation);
            
            // Display recommendation
            displayRecommendation(pit, seam, material, recommendation);
            
            // Save to history
            saveToHistory(pit, seam, material, recommendation);
            
            // Save current recommendation
            currentRecommendation = {
                pit,
                seam,
                material,
                materialName: getMaterialName(material),
                ...recommendation,
                timestamp: new Date().toLocaleString()
            };
        }
        
        function validateInput(pit, seam, material) {
            if (!pit) {
                alert("Silakan pilih PIT terlebih dahulu");
                return false;
            }
            
            if (!seam) {
                alert("Silakan pilih Seam terlebih dahulu");
                return false;
            }
            
            if (!material) {
                alert("Silakan pilih Material terlebih dahulu");
                return false;
            }
            
            return true;
        }
        
        function displayRecommendation(pit, seam, material, recommendation) {
            // Create recommendation HTML
            const html = `
                <div class="recommendation-card">
                    <div class="recommendation-header">
                        <div>
                            <div class="location-info">${pit} - Seam ${seam}</div>
                            <div class="location-details">
                                Material: ${getMaterialName(material)}
                            </div>
                        </div>
                        <div style="font-size: 14px; color: #555;">
                            ${new Date().toLocaleDateString()}
                        </div>
                    </div>
                    
                    <div class="recommendation-grid">
                        <div class="param-card primary">
                            <div class="param-label">Powder Factor</div>
                            <div class="param-value">${recommendation.pf.toFixed(CONFIG.decimalPlaces.pf)}</div>
                            <div class="param-unit">${CONFIG.units.pf}</div>
                        </div>
                        
                        <div class="param-card">
                            <div class="param-label">Burden</div>
                            <div class="param-value">${recommendation.burden.toFixed(CONFIG.decimalPlaces.burden)}</div>
                            <div class="param-unit">${CONFIG.units.burden}</div>
                        </div>
                        
                        <div class="param-card">
                            <div class="param-label">Spasi</div>
                            <div class="param-value">${recommendation.spacing.toFixed(CONFIG.decimalPlaces.spacing)}</div>
                            <div class="param-unit">${CONFIG.units.spacing}</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('resultContainer').innerHTML = html;
            
            // Update notes
            document.getElementById('notesSection').style.display = 'block';
            document.getElementById('notesText').textContent = generateNotes(pit, seam, material, recommendation);
        }
        
        function generateNotes(pit, seam, material, recommendation) {
            const notes = [];
            
            // Material notes
            const materialNotes = {
                claystone: "Claystone: Gunakan stemming yang memadai (minimum 3.0m) dan monitor kondisi air untuk menghindari mud rush. Material ini cenderung sticky ketika basah.",
                siltstone: "Siltstone: Parameter standar memberikan hasil optimal. Pastikan delay timing sesuai untuk fragmentasi yang baik.",
                sandstone: "Sandstone: Pertimbangkan pre-splitting untuk wall control. Material ini membutuhkan PF lebih tinggi untuk fragmentasi optimal."
            };
            
            if (materialNotes[material]) {
                notes.push(materialNotes[material]);
            }
            
            // PF-based notes
            if (recommendation.pf < 0.35) {
                notes.push("PF rendah: Cocok untuk area sensitif, dekat struktur, atau material dengan kekuatan rendah.");
            } else if (recommendation.pf > 0.5) {
                notes.push("PF tinggi: Diperlukan untuk fragmentasi material keras atau ketika dibutuhkan fine fragmentation.");
            }
            
            // Seam-based notes
            if (['35', '36', '37', '38'].includes(seam)) {
                notes.push(`Seam ${seam}: Perhatikan struktur geologi dan joint pattern di area ini.`);
            }
            
            // Location note
            notes.push(`Lokasi: ${pit} - Sesuaikan dengan kondisi aktual di lapangan dan hasil trial shot sebelumnya.`);
            
            return notes.join(" ");
        }
        
        function saveToHistory(pit, seam, material, recommendation) {
            const historyItem = {
                id: Date.now(),
                pit,
                seam,
                material,
                pf: recommendation.pf,
                burden: recommendation.burden,
                spacing: recommendation.spacing,
                timestamp: new Date().toLocaleString()
            };
            
            // Add to beginning of history array
            recommendationHistory.unshift(historyItem);
            
            // Keep only last 5 items
            if (recommendationHistory.length > 5) {
                recommendationHistory = recommendationHistory.slice(0, 5);
            }
            
            // Save to localStorage
            localStorage.setItem('pfRecommendationHistory', JSON.stringify(recommendationHistory));
            
            // Update history display
            updateHistoryDisplay();
        }
        
        function loadHistory() {
            const savedHistory = localStorage.getItem('pfRecommendationHistory');
            if (savedHistory) {
                recommendationHistory = JSON.parse(savedHistory);
                updateHistoryDisplay();
            }
        }
        
        function updateHistoryDisplay() {
            const historySection = document.getElementById('historySection');
            const historyList = document.getElementById('historyList');
            
            if (recommendationHistory.length > 0) {
                historySection.style.display = 'block';
                
                historyList.innerHTML = recommendationHistory.map(item => `
                    <div class="history-item" onclick="loadFromHistory('${item.id}')">
                        ${item.pit} - Seam ${item.seam} | ${getMaterialName(item.material)}<br>
                        PF: ${item.pf.toFixed(2)} kg/m¬≥ | ${item.timestamp}
                    </div>
                `).join('');
            } else {
                historySection.style.display = 'none';
            }
        }
        
        function loadFromHistory(id) {
            const item = recommendationHistory.find(i => i.id == id);
            if (!item) return;
            
            // Set PIT
            document.getElementById('pitSelect').value = item.pit;
            updateSeams(item.pit);
            
            // Need to wait a bit for seams to populate
            setTimeout(() => {
                // Set Seam
                document.getElementById('seamSelect').value = item.seam;
                
                // Set Material
                document.getElementById('materialSelect').value = item.material;
                
                // Generate recommendation with saved values
                generateRecommendation();
            }, 100);
        }
        
        function resetTools() {
            // Reset inputs
            document.getElementById('pitSelect').value = '';
            document.getElementById('seamSelect').value = '';
            document.getElementById('materialSelect').value = '';
            
            // Reset displays
            document.getElementById('notesSection').style.display = 'none';
            
            // Reset result display
            document.getElementById('resultContainer').innerHTML = `
                <div class="recommendation-card" style="opacity: 0.7;">
                    <div class="recommendation-header">
                        <div>
                            <div class="location-info">Pilih Parameter</div>
                            <div class="location-details">Silakan pilih PIT, Seam, dan Material</div>
                        </div>
                    </div>
                    
                    <div class="recommendation-grid">
                        <div class="param-card">
                            <div class="param-label">Powder Factor</div>
                            <div class="param-value">-</div>
                            <div class="param-unit">kg/m¬≥</div>
                        </div>
                        
                        <div class="param-card">
                            <div class="param-label">Burden</div>
                            <div class="param-value">-</div>
                            <div class="param-unit">meter</div>
                        </div>
                        
                        <div class="param-card">
                            <div class="param-label">Spasi</div>
                            <div class="param-value">-</div>
                            <div class="param-unit">meter</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; color: #999; padding: 20px;">
                        <p>Parameter akan ditampilkan setelah Anda mengisi semua data</p>
                    </div>
                </div>
            `;
            
            currentRecommendation = null;
            
            // Reset generate button
            document.getElementById('generateBtn').disabled = true;
        }
        
        // Helper functions
        function getMaterialName(material) {
            const mat = availableMaterials.find(m => m.value === material);
            return mat ? mat.name : material;
        }
    </script>
</body>
</html>
